# Timeslots 2.0

# Требования

**Суть проекта:** Система управления тайм-слотами с возможностью выбора даты, количества паллет и операции. При выдаче свободных тайм-слотов система берет в учет расписание гейтов(если есть), расписание компании(если есть).

Stack: 

Backend: ASP.Net Core, .Net 8, PostgreSQL, MediatR, AutoMapper, FluentValidation, xUnit, Redis, Docker

Frontend: ReactJS, Docker, Nginx

## Системные характеристики

- **СХ-1: Backend**
    - **СХ-1.1:** Приложение запускается в консоли
    - **СХ-1.2:** Приложение использует платформу .NET 8
    - **СХ-1.3:** Для веб разработки используется фреймворк ASP.Net Core
    - **СХ-1.4:** База данных выбрана PostgreSQL
    - **СХ-1.5:** Для реализации принципа CQRS используется библиотека MediatR
    - **СХ-1.6:** Для маппинга объектов используется библиотека AutoMapper
    - **СХ-1.7:** Для валидации используется FluentValidation
    - **СХ-1.8:** Тестирование выполняется с помощью библиотеки xUnit
    - СХ-1.9: Для кэширования используется Redis
- **СХ-2: Frontend**
    - **СХ-2.1:** Для клиентского приложение используется фреймворк ReactJS
- **СХ-3:** И backend и frontend приложения будет развертываться внутри Docker

## Пользовательские требования

- ПТ-1: Администрирование
    - ПТ-1.1: В админ панель можно перейти, если перейти по пути `/admin` в адресной строке
        - ПТ-1.1.1: Если пользователь не авторизован или не авторизован как админ, то высвечивается окно входа где заполняется логин и пароль
    - ПТ-1.2: Админ имеет право выполнять любые действия над всеми объектами
        - ПТ-1.2.1: При нажатии на кнопку “+” открывается модальное окно (см. ДС-1.1)
        - ПТ-1.2.2: При двойном нажатии на платформу/гейт открывается модальное окно(см. ДС-1.1)
        - ПТ-1.2.3: При нажатии на крести в углу объекта вызывается модальное окно подтверждения, при нажатии на “Подтвердить” объект удаляется из базы данных
    - ПТ-1.3: Админ так же может использовать приложение как обычный пользователь.
- ПТ-2: Обычный пользователь
    - ПТ-2.1: При входе на страницу сайта в header есть кнопка “Войти” и “Регистрация”
        - ПТ-2.1.1: При нажатии на кнопку “Регистрация” открывается модальное окно (см. ДС-1.2) после чего пользователь регистрируется в базе данных и получает права только для просмотра тайм-слотов
        - ПТ-2.1.2: При нажатии на кнопку “Войти” открывается модальное окно (см. ДС-1.3) после чего для пользователя есть возможности выполнять разрешенные ему действия
    - ПТ-2.2: Авторизированный пользователь
        - ПТ-2.2.1: Появляется кнопка “Привязаться к компании” при нажатии на которую открывается модальное окно (см. ДС-1.4) после “Ок” пользователь обновляется в базе данных и получает помимо прав просмотра, права бронирования
- ПТ-3: Пользователь компании
    - ПТ-3.1: Обладает правами просмотра и бронирования тайм-слотов
        - ПТ-3.1.1: Для получения тайм-слотов выбирается дата и количество паллетов, после чего выдаются все свободные тайм-слоты (см. ДС-2)
        - ПТ-3.1.2: После получения всех свободных тайм-слотов, пользователь выбирает нужные и при нажатии на кнопку “Забронировать” выбранные тайм-слоты добавляются в базу данных, после чего происходит обновление данных (см. ДС-3)
    - ПТ-3.2: При нажатии на кнопку “Отвязаться от компании” пользователь теряет права бронирования и переходит в группу пользователь “Обычный пользователь”

## Бизнес-правила

- БП-1: Регистрация
    - БП-1.1: Для регистрации нужны: Email, Username(Login), Password(Пароль)
    - БП-1.2: После завершения регистрации созданные пользователь добавляется в группу “Обычный пользователь”
- БП-2: Вход
    - БП-2.1: Для входа в учетную запись нужны: Username(Login), Password(Пароль)
    - БП-2.2: После успешного входа пользователю выдается JWT токен со сроком действительности в 1 час и разрешенными его группе scope’ами
- БП-3: Получение тайм-слотов
    - БП-3.1: Для получения тайм-слотов нужно получить информацию об: Количестве паллет, дата, выполняемая операция
    - БП-3.2: Правила формирования ответа свободных тайм-слотов
        - БП-3.2.1: Сначала система проверяет есть ли в базе данных расписание для компании, к которой приписан пользователь(если приписан)
            - БП-3.2.1.1: Если расписания компании для этой платформы нет, то тогда алгоритм идет дальше (см. БП-3.2.2)
        - БП-3.2.2: Проверяется есть ли для гейтов на какой либо платформе расписание
            - БП-3.2.2.1: Если нет, алгоритм выполняется дальше
        - БП-3.2.3: Соблюдение расписаний
            - БП-3.2.3.1: Для расписаний компаний система так же должна учитывать максимальное количество забронированных тайм-слотов у этого расписания, если же максимальное количество достигнуто, то тогда выполняется алгоритм без учета этого расписания
            - БП-3.2.3.2: Проверяется, есть ли данный день недели(берется из запроса) в расписании(если есть, то расписание применяется)
            - БП-3.2.3.3: Помимо проверки дня недели (см. БП-3.2.3.2) проверяется есть в расписании разрешенная операция, которая указана в запросе
        - БП-3.2.4: Система смотрит на пересечения временных интервалов уже забронированных тайм-слотов в базе данных с теми, которые могут подходить пользователю для его запроса и выдает ответ (см. ДС-3)
        - БП-3.2.5: Все свободные тайм-слоты выдаются в таком формате:
        Предыдущий день | День в запросе | Следующий день (см. ДС-2.3)
- БП-4: Бронирование тайм-слотов
    - БП-4.1: Бронирование - это сохранение информации о тайм-слоте в базе данных, временные интервалы которых используются для формирования свободных тайм-слотов.

## Ограничения

- О-1: Для выбора даты для получения тайм-слотов не допускается выбор даты, которая раньше или равна текущей даты.
- О-2: Количество паллет не может быть отрицательным или нулевым числом, а также превышать 1000
`(0, 1000]`

## Детальные спецификации

- ДС-1: Модальное окно
    - ДС-1.1: Модальное окно для CRUD операций
        - ДС.1.1.1: Должно быть селектор выбора сущности, для которой будет выполняться операция
        - ДС-1.1.2: В соответствии с выбранной операцией (см. ДС-1.1.1) поля заполнения
        - ДС-1.1.3: Кнопка “Ок” - выполняет выбранную операцию (см. ДС-1.1.1) с данными из полей (см. ДС-1.1.2) после нажатии на которую модальное окно закрывается
        - ДС-1.1.4: Кнопка “Отмена” - модальное окно закрывается
    - ДС-1.2: Модальное окно Регистрации
        - ДС-1.2.1: Поля для заполнения электронной почты, имя пользователя, пароля
        - ДС-1.2.2: Кнопка “Зарегистрироваться” - выполняет регистрацию, после чего модальное окно закрывается
        - ДС-1.2.3: Кнопка “Отмена” - закрывает модальное окно
    - ДС-1.3: Модальное окно Входа
        - ДС-1.3.1: Поля для заполнения имени пользователя и пароля
        - ДС-1.3.2: Кнопка “Вход” - авторизирует пользователя в системе после модальное окно закрывается
        - ДС-1.3.2: Кнопка “Отмена” - закрывает модальное окно
    - ДС-1.4: Модальное окно привязки к компании
        - ДС-1.4.1: Селектор всех компаний
        - ДС-1.4.2: Кнопка “Привязаться” - привязывает авторизированного пользователя с выбранной компанией, модальное окно закрывается
        - ДС-1.4.3: Кнопка “Отмена” - закрывает модальное окно
    - ДС-1.5: Все поля ручного ввода текста или чисел должны валидироваться и если введено некорректное значение, то неправильно заполненное поле подсвечивается красным и при попытки нажать на кнопку “Ок” с такими данными выдается сообщение об ошибке
- ДС-2: Получение тайм-слотов
    - ДС-2.1: Из селектора дат выбирается дата (см. О-1)
    - ДС-2.2: В поле “Количество паллет” заполняется числовыми значениями (см. О-2)
    - ДС-2.3: Все тайм-слоты выдаются в виде таблицы, в которой есть колонка для выбора(чек-бокс)
- ДС-3: Все ответы от API должны соответствовать формату:
`{
    “success”: boolean,
    “code”: http code,
    “data”: returned object
}`
